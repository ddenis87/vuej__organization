<template>
  <div class="el-field el-field-string" 
       :class="{'el-field_single-line': isSingleLine, 
                'el-field_hide-message': isHideMessage,
                'el-field_hide-underline': isHideUnderline}">
    <v-text-field class="el-field__item"
                  dense
                  tabindex="1"
                  :single-line="isSingleLine"
                  :hide-details="isHideMessage"
                  :disabled="isDisabled"
                  :label="fieldLabel"
                  :clearable="isBtnClear"
                  :solo="isHideUnderline"
                  :flat="isHideUnderline"
                  :maxLength="fieldMaxLength"
                  :rules="(fieldRequired) ? [rules.required] : []"
                  v-model="fieldValue"
                  @click:clear="eventClearValue"
                  @click.stop
                  @input="eventInputValue"
                  @keydown.enter="eventKeyEnter"
                  @keydown.tab="eventKeyTab"
                  @keydown.esc="eventKeyEsc"
                  @keydown.stop
                  @blur="eventBlurField">
    </v-text-field>
  </div>
</template>

<script>
import { ElField } from './ElField.js';
export default {
  name: 'ElFiledString',
  mixins: [
    ElField,
  ],
  computed: {
    fieldMaxLength() { return ('max_length' in this.inputProperties) ? this.inputProperties['max_length'] : Infinity; },
  },
  mounted() {
    let fieldInput = document.querySelector(`.content-editing .v-text-field__slot input`);
    if (!fieldInput) return;
    if (this.isSelected)
      setTimeout(() => {
        fieldInput.setSelectionRange(0, 0);
        fieldInput.select();
        fieldInput.focus();
      }, 10);
  },
  methods: {
    eventKeyEnter(event) {
      if (this.checkRequiredField(event)) return;

      let sendOption = {
        key: event.key,
        value: this.fieldValue,
        event: event,
      }
      this.isEmit = true;
      this.emitKeyEnter(sendOption);
      this.$emit('next-element', {event: event});
    },
  },
}
</script>

<style lang="scss" scoped>
@import './ElField.scss';
</style>